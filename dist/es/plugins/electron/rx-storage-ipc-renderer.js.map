{"version":3,"file":"rx-storage-ipc-renderer.js","names":["getRxStorageMessageChannel","getFromMapOrThrow","IPC_RENDERER_KEY_PREFIX","IPC_RENDERER_TO_MAIN","getRxStorageIpcRenderer","settings","storage","name","statics","createRemoteStorage","port","params","messageChannel","messageChannelByPort","otherPort","port1","postMessage","message","ipcRenderer","send","key","join"],"sources":["../../../../src/plugins/electron/rx-storage-ipc-renderer.ts"],"sourcesContent":["import {\n    getRxStorageMessageChannel,\n    RxStorageMessageChannel,\n    RxStorageMessageToRemote\n} from '../../rx-storage-message-channel';\nimport type {\n    RxStorageStatics\n} from '../../types';\nimport { getFromMapOrThrow } from '../../util';\nimport {\n    IPC_RENDERER_KEY_PREFIX,\n    IPC_RENDERER_TO_MAIN\n} from './electron-helper';\n\nexport type RxStorageIpcRendererSettings = {\n    key: string;\n    statics: RxStorageStatics;\n    ipcRenderer: any;\n};\n\nexport type RxStorageIpcRenderer = RxStorageMessageChannel;\nexport function getRxStorageIpcRenderer(\n    settings: RxStorageIpcRendererSettings\n): RxStorageIpcRenderer {\n\n    const storage = getRxStorageMessageChannel({\n        name: 'ipc-renderer',\n        statics: settings.statics,\n        createRemoteStorage: (\n            port,\n            params\n        ) => {\n\n            /**\n             * Electron does not allow to send messages\n             * via ports from ipcRenderer->ipcMain.\n             * Therefore we have to overwrite the port1.postMessage()\n             * so that it works over args.ipcMain.on() messages.\n             */\n            const messageChannel = getFromMapOrThrow(storage.messageChannelByPort, port);\n            const otherPort = messageChannel.port1;\n            otherPort.postMessage = function (message: RxStorageMessageToRemote) {\n                settings.ipcRenderer.send(IPC_RENDERER_TO_MAIN, message);\n            };\n\n            settings.ipcRenderer.postMessage(\n                [\n                    IPC_RENDERER_KEY_PREFIX,\n                    'postMessage',\n                    settings.key,\n                    'createStorageInstance'\n                ].join('|'),\n                params,\n                [port]\n            );\n        }\n    });\n    return storage;\n}\n"],"mappings":"AAAA,SACIA,0BAA0B,QAGvB,kCAAkC;AAIzC,SAASC,iBAAiB,QAAQ,YAAY;AAC9C,SACIC,uBAAuB,EACvBC,oBAAoB,QACjB,mBAAmB;AAS1B,OAAO,SAASC,uBAAuB,CACnCC,QAAsC,EAClB;EAEpB,IAAMC,OAAO,GAAGN,0BAA0B,CAAC;IACvCO,IAAI,EAAE,cAAc;IACpBC,OAAO,EAAEH,QAAQ,CAACG,OAAO;IACzBC,mBAAmB,EAAE,6BACjBC,IAAI,EACJC,MAAM,EACL;MAED;AACZ;AACA;AACA;AACA;AACA;MACY,IAAMC,cAAc,GAAGX,iBAAiB,CAACK,OAAO,CAACO,oBAAoB,EAAEH,IAAI,CAAC;MAC5E,IAAMI,SAAS,GAAGF,cAAc,CAACG,KAAK;MACtCD,SAAS,CAACE,WAAW,GAAG,UAAUC,OAAiC,EAAE;QACjEZ,QAAQ,CAACa,WAAW,CAACC,IAAI,CAAChB,oBAAoB,EAAEc,OAAO,CAAC;MAC5D,CAAC;MAEDZ,QAAQ,CAACa,WAAW,CAACF,WAAW,CAC5B,CACId,uBAAuB,EACvB,aAAa,EACbG,QAAQ,CAACe,GAAG,EACZ,uBAAuB,CAC1B,CAACC,IAAI,CAAC,GAAG,CAAC,EACXV,MAAM,EACN,CAACD,IAAI,CAAC,CACT;IACL;EACJ,CAAC,CAAC;EACF,OAAOJ,OAAO;AAClB"}